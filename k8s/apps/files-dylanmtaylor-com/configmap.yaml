apiVersion: v1
kind: ConfigMap
metadata:
  name: files-dylanmtaylor-com-config
  namespace: dylanmtaylor
data:
  NGINX_CONFIG: |
    server {
      listen 8080;
      server_name files.dylanmtaylor.com files.dylanmtaylor.local;
      
      # Redirect root to index.html
      location = / {
        return 301 /index.html;
      }
      
      location / {
        # Rewrite to OCI Object Storage
        rewrite ^/(.*)$ /n/iderusgdpmur/b/dylanmtaylor_public_files/o/$1 break;
        
        proxy_pass https://objectstorage.us-ashburn-1.oraclecloud.com;
        proxy_set_header Host objectstorage.us-ashburn-1.oraclecloud.com;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # Pass through original filename
        proxy_redirect off;
        
        # Cache settings
        proxy_cache_valid 200 1h;
        proxy_cache_bypass $http_cache_control;
        add_header X-Cache-Status $upstream_cache_status;
      }
      
      # Health check endpoint
      location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
      }
    }
