---
apiVersion: v1
kind: Namespace
metadata:
  name: native-ingress-controller-system
---
apiVersion: source.toolkit.fluxcd.io/v1
kind: HelmRepository
metadata:
  name: oci-native-ingress-controller
  namespace: flux-system
spec:
  interval: 24h
  url: https://oracle.github.io/oci-native-ingress-controller
---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: oci-native-ingress-controller
  namespace: flux-system
spec:
  interval: 30m
  chart:
    spec:
      chart: oci-native-ingress-controller
      version: "1.4.2"
      sourceRef:
        kind: HelmRepository
        name: oci-native-ingress-controller
        namespace: flux-system
      interval: 12h
  targetNamespace: native-ingress-controller-system
  install:
    createNamespace: false
    remediation:
      retries: 3
  upgrade:
    remediation:
      retries: 3
  values:
    # Authentication configuration
    authType: instance
    authSecretName: oci-config

    # Controller configuration
    controllerClass: oci.oraclecloud.com/native-ingress-controller

    # OCI configuration - these will be auto-detected or can be set
    compartmentId: ""
    subnetId: ""
    clusterId: ""

    # Metrics configuration
    metricsBackend: prometheus
    metricsPort: 2223

    # Certificate management
    useLBCompartmentForCertificates: false
    certDeletionGracePeriodInDays: 0

    # Event emission
    emitEvents: false

    # Image configuration
    image:
      repository: ghcr.io/oracle/oci-native-ingress-controller
      tag: v1.4.2
      pullPolicy: Always

    # Resource configuration
    resources: {}

    # Replica configuration
    replicaCount: 1

    # Security context
    securityContext:
      runAsNonRoot: true
      runAsUser: 1000
      seccompProfile:
        type: RuntimeDefault

    # Priority class
    priorityClassName: system-cluster-critical
